{
  "models": [
    {
      "name": "rigid_body",
      "description": "A 6DOF rigid body dynamics model with position, velocity, and attitude states. The mass is 60 kg, and the inertia is a diagonal matrix with values [10, 10, 30].",
      "parameters": [
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "mass",
            "unit": "kg",
            "description": "Mass of the rigid body."
          },
          "value": [
            60.0
          ]
        },
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "Ixx",
            "unit": "kg*m^2",
            "description": "Moment of inertia about the x-axis."
          },
          "value": [
            10.0
          ]
        },
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "Iyy",
            "unit": "kg*m^2",
            "description": "Moment of inertia about the y-axis."
          },
          "value": [
            10.0
          ]
        },
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "Izz",
            "unit": "kg*m^2",
            "description": "Moment of inertia about the z-axis."
          },
          "value": [
            30.0
          ]
        }
      ],
      "inputs": [
        {
          "dimension": [
            1
          ],
          "name": "Fx",
          "unit": "N",
          "description": "External force in the x-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "Fy",
          "unit": "N",
          "description": "External force in the y-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "Fz",
          "unit": "N",
          "description": "External force in the z-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "Mx",
          "unit": "N*m",
          "description": "External moment about the x-axis."
        },
        {
          "dimension": [
            1
          ],
          "name": "My",
          "unit": "N*m",
          "description": "External moment about the y-axis."
        },
        {
          "dimension": [
            1
          ],
          "name": "Mz",
          "unit": "N*m",
          "description": "External moment about the z-axis."
        }
      ],
      "outputs": [
        {
          "dimension": [
            1
          ],
          "name": "x",
          "unit": "m",
          "description": "Position in the x-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "y",
          "unit": "m",
          "description": "Position in the y-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "z",
          "unit": "m",
          "description": "Position in the z-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "u",
          "unit": "m/s",
          "description": "Velocity in the x-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "v",
          "unit": "m/s",
          "description": "Velocity in the y-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "w",
          "unit": "m/s",
          "description": "Velocity in the z-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "phi",
          "unit": "rad",
          "description": "Roll angle."
        },
        {
          "dimension": [
            1
          ],
          "name": "theta",
          "unit": "rad",
          "description": "Pitch angle."
        },
        {
          "dimension": [
            1
          ],
          "name": "psi",
          "unit": "rad",
          "description": "Yaw angle."
        },
        {
          "dimension": [
            1
          ],
          "name": "p",
          "unit": "rad/s",
          "description": "Roll rate."
        },
        {
          "dimension": [
            1
          ],
          "name": "q",
          "unit": "rad/s",
          "description": "Pitch rate."
        },
        {
          "dimension": [
            1
          ],
          "name": "r",
          "unit": "rad/s",
          "description": "Yaw rate."
        }
      ],
      "states": [
        {
          "dimension": [
            1
          ],
          "name": "x",
          "unit": "m",
          "description": "Position in the x-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "y",
          "unit": "m",
          "description": "Position in the y-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "z",
          "unit": "m",
          "description": "Position in the z-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "u",
          "unit": "m/s",
          "description": "Velocity in the x-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "v",
          "unit": "m/s",
          "description": "Velocity in the y-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "w",
          "unit": "m/s",
          "description": "Velocity in the z-direction."
        },
        {
          "dimension": [
            1
          ],
          "name": "phi",
          "unit": "rad",
          "description": "Roll angle."
        },
        {
          "dimension": [
            1
          ],
          "name": "theta",
          "unit": "rad",
          "description": "Pitch angle."
        },
        {
          "dimension": [
            1
          ],
          "name": "psi",
          "unit": "rad",
          "description": "Yaw angle."
        },
        {
          "dimension": [
            1
          ],
          "name": "p",
          "unit": "rad/s",
          "description": "Roll rate."
        },
        {
          "dimension": [
            1
          ],
          "name": "q",
          "unit": "rad/s",
          "description": "Pitch rate."
        },
        {
          "dimension": [
            1
          ],
          "name": "r",
          "unit": "rad/s",
          "description": "Yaw rate."
        }
      ],
      "equations": {
        "linear_model": null,
        "nonlinear_model": {
          "dynamics_python": "def dynamics(t, x, u, params):\n    # Unpack states\n    pos = x[:3]  # Position [x, y, z]\n    vel = x[3:6]  # Velocity [u, v, w]\n    euler = x[6:9]  # Euler angles [phi, theta, psi]\n    omega = x[9:]  # Angular rates [p, q, r]\n\n    # Unpack inputs\n    force = u[:3]  # Forces [Fx, Fy, Fz]\n    moments = u[3:]  # Moments [Mx, My, Mz]\n\n    # Unpack parameters\n    mass = params['mass']\n    Ixx = params['Ixx']\n    Iyy = params['Iyy']\n    Izz = params['Izz']\n\n    # Rotation matrix from body to inertial frame\n    phi, theta, psi = euler\n    R = np.array([\n        [np.cos(theta)*np.cos(psi), np.cos(theta)*np.sin(psi), -np.sin(theta)],\n        [np.sin(phi)*np.sin(theta)*np.cos(psi) - np.cos(phi)*np.sin(psi), np.sin(phi)*np.sin(theta)*np.sin(psi) + np.cos(phi)*np.cos(psi), np.sin(phi)*np.cos(theta)],\n        [np.cos(phi)*np.sin(theta)*np.cos(psi) + np.sin(phi)*np.sin(psi), np.cos(phi)*np.sin(theta)*np.sin(psi) - np.sin(phi)*np.cos(psi), np.cos(phi)*np.cos(theta)]\n    ])\n\n    # Kinematic equations\n    ddt_pos = R @ vel\n    ddt_vel = force / mass - np.cross(omega, vel)\n\n    # Euler angle rates\n    ddt_euler = np.array([\n        [1, np.sin(phi)*np.tan(theta), np.cos(phi)*np.tan(theta)],\n        [0, np.cos(phi), -np.sin(phi)],\n        [0, np.sin(phi)/np.cos(theta), np.cos(phi)/np.cos(theta)]\n    ]) @ omega\n\n    # Angular rate dynamics\n    ddt_omega = np.array([\n        (moments[0] - (Iyy - Izz) * omega[1] * omega[2]) / Ixx,\n        (moments[1] - (Izz - Ixx) * omega[2] * omega[0]) / Iyy,\n        (moments[2] - (Ixx - Iyy) * omega[0] * omega[1]) / Izz\n    ])\n\n    return np.hstack([ddt_pos, ddt_vel, ddt_euler, ddt_omega])",
          "output_python": "def outputs(t, x, u, params):\n    return x  # Outputs are the states themselves"
        },
        "algebraic_model": null,
        "packages": [
          "import control as ct",
          "import numpy as np"
        ]
      }
    },
    {
      "name": "thrust_model",
      "description": "A thrust model for a quadcopter with a maximum thrust of 100 newtons. The model outputs the thrust force and the moment vector based on the input control signal and the mounting location.",
      "parameters": [
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "max_thrust",
            "unit": "newton",
            "description": "Maximum thrust force the quadcopter can produce."
          },
          "value": [
            100.0
          ]
        },
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "r",
            "unit": "meter",
            "description": "Mounting location vector from the center of gravity."
          },
          "value": [
            0.5
          ]
        }
      ],
      "inputs": [
        {
          "dimension": [
            1
          ],
          "name": "control_signal",
          "unit": null,
          "description": "Control signal input to the thrust model, typically between 0 and 1."
        }
      ],
      "outputs": [
        {
          "dimension": [
            1
          ],
          "name": "thrust",
          "unit": "newton",
          "description": "Thrust force output of the quadcopter."
        },
        {
          "dimension": [
            1
          ],
          "name": "moment",
          "unit": "newton_meter",
          "description": "Moment vector about the center of gravity."
        }
      ],
      "states": null,
      "equations": {
        "linear_model": null,
        "nonlinear_model": null,
        "algebraic_model": {
          "output_python": "def outputs(t, x, u, params):\n    # Extract the control signal, maximum thrust, and mounting location\n    control_signal = u[0]\n    max_thrust = params['max_thrust']\n    r = params['r']\n    \n    # Calculate the thrust\n    thrust = control_signal * max_thrust\n    \n    # Calculate the moment as the cross product of r and thrust\n    moment = r * thrust\n    \n    return [thrust, moment]"
        },
        "packages": [
          "import control as ct"
        ]
      }
    },
    {
      "name": "gravity_force_model",
      "description": "Rotates the gravity vector from the navigation frame to the body frame using Euler angles (phi, theta, psi). Outputs the gravity force vector in the body frame.",
      "parameters": null,
      "inputs": [
        {
          "dimension": [
            1
          ],
          "name": "phi",
          "unit": "radians",
          "description": "Roll angle for rotation from navigation to body frame."
        },
        {
          "dimension": [
            1
          ],
          "name": "theta",
          "unit": "radians",
          "description": "Pitch angle for rotation from navigation to body frame."
        },
        {
          "dimension": [
            1
          ],
          "name": "psi",
          "unit": "radians",
          "description": "Yaw angle for rotation from navigation to body frame."
        }
      ],
      "outputs": [
        {
          "dimension": [
            1
          ],
          "name": "Fx",
          "unit": "N",
          "description": "X-component of the gravity force vector in the body frame."
        },
        {
          "dimension": [
            1
          ],
          "name": "Fy",
          "unit": "N",
          "description": "Y-component of the gravity force vector in the body frame."
        },
        {
          "dimension": [
            1
          ],
          "name": "Fz",
          "unit": "N",
          "description": "Z-component of the gravity force vector in the body frame."
        }
      ],
      "states": null,
      "equations": {
        "linear_model": null,
        "nonlinear_model": null,
        "algebraic_model": {
          "output_python": "import numpy as np\n\ndef outputs(t, x, u, params):\n    phi, theta, psi = u\n    # Gravity vector in navigation frame (NED)\n    g_ned = np.array([0, 0, 9.81])\n    \n    # Rotation matrix from navigation frame to body frame\n    R = np.array([\n        [np.cos(theta)*np.cos(psi), np.cos(theta)*np.sin(psi), -np.sin(theta)],\n        [np.sin(phi)*np.sin(theta)*np.cos(psi) - np.cos(phi)*np.sin(psi), np.sin(phi)*np.sin(theta)*np.sin(psi) + np.cos(phi)*np.cos(psi), np.sin(phi)*np.cos(theta)],\n        [np.cos(phi)*np.sin(theta)*np.cos(psi) + np.sin(phi)*np.sin(psi), np.cos(phi)*np.sin(theta)*np.sin(psi) - np.sin(phi)*np.cos(psi), np.cos(phi)*np.cos(theta)]\n    ])\n    \n    # Gravity vector in body frame\n    g_body = R @ g_ned\n    \n    return g_body.tolist()"
        },
        "packages": [
          "import control as ct",
          "import numpy as np"
        ]
      }
    }
  ],
  "subsystems": [
    {
      "name": "quadcopter_system",
      "description": "Subsystem for quadcopter dynamics including thrust, gravity, and rigid body dynamics.",
      "components": [
        {
          "name": "thrust1",
          "connections": [
            {
              "destination_port_name": "control_signal",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "External",
                  "port_name": "control_signal1",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            }
          ]
        },
        {
          "name": "thrust2",
          "connections": [
            {
              "destination_port_name": "control_signal",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "External",
                  "port_name": "control_signal2",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            }
          ]
        },
        {
          "name": "thrust3",
          "connections": [
            {
              "destination_port_name": "control_signal",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "External",
                  "port_name": "control_signal3",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            }
          ]
        },
        {
          "name": "thrust4",
          "connections": [
            {
              "destination_port_name": "control_signal",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "External",
                  "port_name": "control_signal4",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            }
          ]
        },
        {
          "name": "gravity_force",
          "connections": [
            {
              "destination_port_name": "phi",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "rigid_body",
                  "port_name": "phi",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            },
            {
              "destination_port_name": "theta",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "rigid_body",
                  "port_name": "theta",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            },
            {
              "destination_port_name": "psi",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "rigid_body",
                  "port_name": "psi",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            }
          ]
        },
        {
          "name": "rigid_body",
          "connections": [
            {
              "destination_port_name": "Fx",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "thrust1",
                  "port_name": "thrust",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust2",
                  "port_name": "thrust",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust3",
                  "port_name": "thrust",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust4",
                  "port_name": "thrust",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "gravity_force",
                  "port_name": "Fx",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            },
            {
              "destination_port_name": "Fy",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "gravity_force",
                  "port_name": "Fy",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            },
            {
              "destination_port_name": "Fz",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "gravity_force",
                  "port_name": "Fz",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            },
            {
              "destination_port_name": "Mx",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "thrust1",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust2",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust3",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust4",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            },
            {
              "destination_port_name": "My",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "thrust1",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust2",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust3",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust4",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            },
            {
              "destination_port_name": "Mz",
              "destination_port_indices": [],
              "source_ports": [
                {
                  "component_name": "thrust1",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust2",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust3",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                },
                {
                  "component_name": "thrust4",
                  "port_name": "moment",
                  "gain": 1.0,
                  "indices": []
                }
              ]
            }
          ]
        }
      ],
      "inputs": [
        {
          "dimension": [
            1
          ],
          "name": "control_signal1",
          "unit": null,
          "description": "Control signal for thrust model 1."
        },
        {
          "dimension": [
            1
          ],
          "name": "control_signal2",
          "unit": null,
          "description": "Control signal for thrust model 2."
        },
        {
          "dimension": [
            1
          ],
          "name": "control_signal3",
          "unit": null,
          "description": "Control signal for thrust model 3."
        },
        {
          "dimension": [
            1
          ],
          "name": "control_signal4",
          "unit": null,
          "description": "Control signal for thrust model 4."
        }
      ],
      "outputs": [
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "x",
            "unit": "m",
            "description": "Position in the x-direction."
          },
          "source_ports": [
            {
              "component_name": "rigid_body",
              "port_name": "x",
              "gain": 1.0,
              "indices": []
            }
          ]
        },
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "y",
            "unit": "m",
            "description": "Position in the y-direction."
          },
          "source_ports": [
            {
              "component_name": "rigid_body",
              "port_name": "y",
              "gain": 1.0,
              "indices": []
            }
          ]
        },
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "z",
            "unit": "m",
            "description": "Position in the z-direction."
          },
          "source_ports": [
            {
              "component_name": "rigid_body",
              "port_name": "z",
              "gain": 1.0,
              "indices": []
            }
          ]
        },
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "phi",
            "unit": "rad",
            "description": "Roll angle."
          },
          "source_ports": [
            {
              "component_name": "rigid_body",
              "port_name": "phi",
              "gain": 1.0,
              "indices": []
            }
          ]
        },
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "theta",
            "unit": "rad",
            "description": "Pitch angle."
          },
          "source_ports": [
            {
              "component_name": "rigid_body",
              "port_name": "theta",
              "gain": 1.0,
              "indices": []
            }
          ]
        },
        {
          "port": {
            "dimension": [
              1
            ],
            "name": "psi",
            "unit": "rad",
            "description": "Yaw angle."
          },
          "source_ports": [
            {
              "component_name": "rigid_body",
              "port_name": "psi",
              "gain": 1.0,
              "indices": []
            }
          ]
        }
      ]
    }
  ]
}